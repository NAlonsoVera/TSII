var OnSuccessCalificacion,OnFailureCalificacion;$(function(){function o(){let t=parseInt(n.val());$.ajax({url:`/Producto/ObtenerCalificacionGeneral?pk_eProducto=${t}`,type:"GET",dataType:"json",success:function(n){$(".commentary").html("");$(".commentary").append(`
                <div class="row">
                <div class="col-md-12 text-valoration-star">
                    <div class="valoration-star" style="text-align:left">
                        <fieldset class="rating">
                            <img style="height: 23px;" src="/Content/image/star/${n.cImagenEstrella}" alt="">
                        </fieldset>
                    </div>
                    <div class="linea-separator-star"></div>
                </div>
            </div>`)}})}function s(i){let r=parseInt(t.val()),f=parseInt($(".stock-details").attr("data-stock"));fetch(`/Producto/ConsultaStock?codigoInterno=${e.val()}`).then(n=>n.json()).then(e=>{parseInt(e.stock)>=r?$.ajax({url:"/Login/ValidateSession",type:"GET",success:function(e){if(e)$.ajax({url:"/ShoppingCart/Agregar",data:{pk_eProducto:parseInt(n.val()),eCantidad:t.val(),opcion:i},type:"POST",success:function(t){t.Success?i==="btnComprarAhora"?(mpolRefreshItem(!0),window.location.href="/CheckOut/"):$("#mobile").css("display")=="none"?window.location.href="/ShoppingCart":$("#mobile").css("display")=="none"?window.location.href="/ShoppingCart":(u(parseInt(n.val())),mpolRefreshItem(!0)):i==="btnComprarAhora"?swal.fire("Algo salió mal!",t.MessageError,"error"):swal.fire("Fuera de stock!",t.MessageError,"info");$(".loading").hide()}});else{let t=mpolLocalStorage("mpol_carritotemporal").get();t.some(t=>t.pk_eProducto===parseInt(n.val()))?$.each(t,function(t,e){if(e.pk_eProducto===parseInt(n.val())){let o=e.eCantidad+r;if(i==="btnComprarAhora")e.eCantidad=o>f?f:e.eCantidad+r,mpolLocalStorage("mpol_carritotemporal").set(t,e),window.location.href="/CheckOut/";else if(o<=f)e.eCantidad=o,mpolLocalStorage("mpol_carritotemporal").set(t,e),$("#mobile").css("display")=="none"?window.location.href="/ShoppingCart":u(parseInt(n.val()));else return swal.fire("Fuera de stock!",`La cantidad a guardar en el carrito supera al stock.<br/> Usted ya cuenta con ${e.eCantidad} unidades agregadas.`,"info"),!1}}):(mpolLocalStorage("mpol_carritotemporal").add({pk_eProducto:parseInt(n.val()),eCantidad:r}),i==="btnComprarAhora"?window.location.href="/CheckOut/":$("#mobile").css("display")=="none"?window.location.href="/ShoppingCart":u(parseInt(n.val())));$(".loading").hide();mpolRefreshItem(!1)}},beforeSend:function(){$(".loading").show()}}):swal.fire("Algo Salio Mal!","La cantidad que se desea agregar es mayor al stock actual!","error")})}function u(n){$.ajax({url:"/Producto/PartialProductoConfirmed?id="+n,dataType:"html",success:function(n){$("body").append(n)}})}function i(){$.ajax({url:`/Producto/ListaCalificacion?id=${parseInt(n.val())}&eTipo=${$("#filter").val()}`,type:"GET",dataType:"json",success:function(n){n&&($(".lstComentario").html(""),$.each(n,function(n,t){console.log(t);$(".lstComentario").append(`
                                    <div class="content-calification-filter text-justify">
									        <div class="content-comment-valoration">
										        <img class="imgStar" src="/Content/image/star/${t.dCalificacion==.5?"star-half.jpg":t.dCalificacion==1?"star1.jpg":t.dCalificacion==1.5?"star1-half.jpg":t.dCalificacion==2?"star2.jpg":t.dCalificacion==3.5?"star3-half.jpg":t.dCalificacion==4?"star4.jpg":t.dCalificacion==4.5?"star4-half.jpg":t.dCalificacion==2.5?"star2-half.jpg":t.dCalificacion==3?"star3.jpg":"star5.jpg"}" alt="${t.dCalificacion}"  style="height: 20px;" >
										        <p>
											        ${t.ls[0].cComentario}
										        </p>
										        <div class="row">
											        <div class="col-md-6 name-client">
												        <p>${t.ls[0].cCliente} el ${new Date(t.fFechaCrea).format("dd-mm-yyyy")}</p>
											        </div>
											        <div class="col-md-6 confirm-client">
												        <ul>
													        <li><p>¿Te fué util esta respuesta?</p></li>
													        <li><a href="javascript:void(0)" class="btnYes" data-pk="${t.pk_eProductoCalificacion}"> Si <span>(${t.eCantidadSi==null?"0":t.eCantidadSi})</span></a></li>
													        <li><a href="javascript:void(0)" class="btnNo" data-pk="${t.pk_eProductoCalificacion}"> No <span>(${t.eCantidadNo==null?"0":t.eCantidadNo})</span></a></li>
												        </ul>
											        </div>
										        </div>
									        </div>
                                           ${t.ls[0].cRespuesta?` <div class="content-comment-valoration response">
											        <div class="content-text-admin">
												        <p>${t.ls[0].cRespuesta}</p>
												        <div class="row">
													        <div class="col-md-12 name-admin">
														        <p>Usuario de Gustilandia</p>
													        </div>
												        </div>
											        </div>

									        </div>`:``}
                                    </div>
                            `)}))}})}function c(){fetch(`/Producto/ConsultaStock?codigoInterno=${e.val()}`).then(n=>n.json()).then(n=>{n.stock<=0?($("#buttons-details-info").removeAttr("style").css("display","block"),$("#buttons-details-sale").removeAttr("style").css("display","none"),$(".item__quantity").remove(),$(".stock-details").text(`Sin Stock`).css("background-color","#00A300").remove()):($("#buttons-details-sale").removeAttr("style").css("display","block"),$(".stock-details").text(`En Stock : ${parseInt(n.stock)}`).attr("data-stock",parseInt(n.stock)),$(".stock-details").css("background-color","#00A300"))})}var f=$("#frmCalificacionMant"),r;const h=$("#btnAgregarCarrito"),t=$("#iptCantProducto"),n=$("input[type=hidden]#pk_eProducto");r=$(".lstComentario");const e=$("#cCodigoInterno");ConsultarFavoritos();$(".products-gallery").easyZoom({width:500,height:500,position:"center",background:"#222"});h.on("click",function(){s("")});$("#btnPlus,#btnMinus").on("click",function(){const i=$(this),r=i.hasClass("deleteCantProduct")?-1:1;let u=parseInt($(".stock-details").attr("data-stock")),n=parseInt(t.val());i.hasClass("addCantProduct")&&n>=1&&n<u?t.val(n+r):i.hasClass("deleteCantProduct")&&n>1&&t.val(n+r)});r.on("click","li>.btnYes",function(){$this=$(this).attr("data-pk");$.ajax({url:`/Producto/UsefulAnswer?id=${$this}&eTipo=1`,type:"POST",success:function(n){n.Success===!0&&i()}})});r.on("click","li>.btnNo",function(){$this=$(this).attr("data-pk");$.ajax({url:`/Producto/UsefulAnswer?id=${$this}&eTipo=2`,type:"POST",success:function(n){n.Success===!0&&i()}})});OnSuccessCalificacion=function(n){f.find("span[data-valmsg-for]").text("");n.Success?(f[0].reset(),o(),i()):n.Errors&&$.each(n.Errors,function(n,t){$("span[data-valmsg-for="+t.Key+"]")[0]&&$("span[data-valmsg-for="+t.Key+"]").text(t.Message)})};OnFailureCalificacion=function(n){swal.fire("Algo Salio Mal!",n.Error,"error")};$("#filter").on("change",function(){i()});$(".btnComprarAhora").on("click",function(){s("btnComprarAhora")});$(document).ready(function(){o();c()})});