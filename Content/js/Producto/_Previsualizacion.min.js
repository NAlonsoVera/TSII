$(function(){function e(){let t=parseInt(n.val());$.ajax({url:`/Producto/ObtenerCalificacionGeneral?pk_eProducto=${t}`,type:"GET",dataType:"json",success:function(n){$("#DivCommentary").html("");$("#DivCommentary").append(`
                <div class="row">
                <div class="col-md-12 text-valoration-star">
                    <div class="valoration-star" style="text-align:left">
                        <fieldset class="rating">
                            <img style="height: 23px;" src="/Content/image/star/${n.cImagenEstrella}" alt="">
                        </fieldset>
                    </div>
                    <div class="linea-separator-star"></div>
                </div>
            </div>`);$("#DivCommentaryMovil").html("");$("#DivCommentaryMovil").append(`
                <div class="row">
                <div class="col-md-12 text-valoration-star">
                    <div class="valoration-star" style="text-align:left">
                        <fieldset class="rating">
                            <img style="height: 23px;" src="/Content/image/star/${n.cImagenEstrella}" alt="">
                        </fieldset>
                    </div>
                    <div class="linea-separator-star"></div>
                </div>
            </div>`)}})}function o(i){let f=parseInt(t.val()),e=parseInt($(".stock-details").attr("data-stock"));fetch(`/Producto/ConsultaStock?codigoInterno=${r.val()}`).then(n=>n.json()).then(r=>{parseInt(r.stock)>=f?$.ajax({url:"/Login/ValidateSession",type:"GET",success:function(r){if(r)$.ajax({url:"/ShoppingCart/Agregar",data:{pk_eProducto:parseInt(n.val()),eCantidad:t.val(),opcion:i},type:"POST",success:function(t){t.Success?i==="btnComprarAhora"?(mpolRefreshItem(!0),window.location.href="/CheckOut/"):(u(parseInt(n.val())),mpolRefreshItem(!0)):i==="btnComprarAhora"?swal.fire("Algo saliÃ³ mal!",t.MessageError,"error"):swal.fire("Fuera de stock!",t.MessageError,"info");$(".loading").hide()}});else{let t=mpolLocalStorage("mpol_carritotemporal").get();t.some(t=>t.pk_eProducto===parseInt(n.val()))?$.each(t,function(t,r){if(r.pk_eProducto===parseInt(n.val())){let o=r.eCantidad+f;if(i==="btnComprarAhora")r.eCantidad=o>e?e:r.eCantidad+f,mpolLocalStorage("mpol_carritotemporal").set(t,r),window.location.href="/CheckOut/";else if(o<=e)r.eCantidad=o,mpolLocalStorage("mpol_carritotemporal").set(t,r),u(parseInt(n.val()));else return swal.fire("Fuera de stock!",`La cantidad a guardar en el carrito supera al stock.<br/> Usted ya cuenta con ${r.eCantidad} unidades agregadas.`,"info"),!1}}):(mpolLocalStorage("mpol_carritotemporal").add({pk_eProducto:parseInt(n.val()),eCantidad:f}),i==="btnComprarAhora"?window.location.href="/CheckOut/":u(parseInt(n.val())));$(".loading").hide();mpolRefreshItem(!1)}},beforeSend:function(){$(".loading").show()}}):swal.fire("Algo Salio Mal!","La cantidad que se desea agregar es mayor al stock actual!","error")})}function u(){i.modal("hide");i.parent().remove();window.location.href="/ShoppingCart/"}function s(){console.log("saaaa "+r.val());fetch(`/Producto/ConsultaStock?codigoInterno=${r.val()}`).then(n=>n.json()).then(n=>{n.stock<=0?($("#buttons-details-info").removeAttr("style").css("display","block"),$("#buttons-details-sale").removeAttr("style").css("display","none"),$(".item__quantity").remove(),$(".stock-details").text(`Sin Stock`).css("background-color","#00A300").remove()):($("#buttons-details-sale").removeAttr("style").css("display","block"),$(".stock-details").text(`En Stock : ${parseInt(n.stock)}`).attr("data-stock",parseInt(n.stock)),$(".stock-details").css("background-color","#00A300"))})}const n=$("#pk_eProducto"),t=$("#iptCantProducto"),f=$("#btnAgregarCarrito"),r=$("#cCodigoInterno");e();s();$("#btnPlus,#btnMinus").on("click",function(){const i=$(this),r=i.hasClass("deleteCantProduct")?-1:1;let u=parseInt($(".stock-details").attr("data-stock")),n=parseInt(t.val());i.hasClass("addCantProduct")&&n>=1&&n<u?t.val(n+r):i.hasClass("deleteCantProduct")&&n>1&&t.val(n+r)});f.on("click",function(){o("")});var i=$("#ModalConfirmed");i.on("hidden.bs.modal",function(){$(this).parent().remove()});i.modal("show")});